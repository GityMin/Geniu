<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Geniu Login</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap">
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<style>
body {
    margin:0; padding:0;
    font-family: 'Orbitron', sans-serif;
    background: linear-gradient(135deg,#ff0080,#ff8c00,#8000ff);
    color: #fff;
}
header {
    display:flex;
    justify-content: space-between;
    align-items:center;
    background: rgba(0,0,0,0.7);
    padding: 15px 30px;
    position: fixed;
    top:0; left:0; right:0;
    z-index:100;
    box-shadow:0 0 15px rgba(0,0,0,0.5);
}
header .logo { font-size:24px; font-weight:700; color:#ff69b4; }
header nav a {
    color:#ff69b4; margin-right:20px; text-decoration:none; font-weight:600;
    transition:0.3s;
    cursor:pointer;
}
header nav a:hover { color:#fff; text-shadow:0 0 8px #ff69b4; }
.container { margin-top:90px; max-width:700px; margin-left:auto; margin-right:auto; padding:25px; background: rgba(0,0,0,0.5); border-radius:20px; box-shadow:0 0 25px rgba(255,20,147,0.5); animation: fadeIn 1s ease; }
h1,h2 { text-align:center; }
input, select, button { width:100%; padding:12px; margin:10px 0; border-radius:10px; border:none; font-size:16px; outline:none; }
input { background: rgba(255,255,255,0.1); color:#fff; }
input::placeholder { color:#ffb6c1; }
select { background: rgba(255,255,255,0.1); color:#fff; }
button { background: #ff69b4; color:#fff; font-weight:bold; cursor:pointer; transition:0.3s; box-shadow:0 0 10px #ff69b4; }
button:hover { background:#ff1493; box-shadow:0 0 20px #ff1493; }
#message { text-align:center; margin-top:10px; color:#ffb6c1; }
.hidden { display:none; }
.panel { background: rgba(255,255,255,0.05); padding:15px; border-radius:12px; margin-top:20px; display:none; animation: slideDown 0.5s ease; }
table { width:100%; border-collapse: collapse; margin-top:10px; }
th, td { border:1px solid #ff69b4; padding:5px; text-align:center; }
th { background: rgba(255,105,180,0.2); color:#fff; }
#chat-box p { margin:5px 0; opacity:0; transform:translateY(-10px); animation: msgFade 0.3s forwards; }
@keyframes msgFade { to { opacity:1; transform:translateY(0); } }
@keyframes fadeIn { from {opacity:0} to {opacity:1} }
@keyframes slideDown { from {opacity:0; transform:translateY(-20px);} to {opacity:1; transform:translateY(0);} }
.tab-content { display:none; margin-top:20px; animation: fadeIn 0.5s ease; }
.tab-content.active { display:block; }
</style>
</head>
<body>

<header>
    <div class="logo">Geniu</div>
    <nav>
        <a data-tab="home">Главная</a>
        <a data-tab="games">Игры</a>
        <a data-tab="store">Магазин</a>
        <a data-tab="rating">Рейтинг</a>
        <a data-tab="owner">О владельце</a>
    </nav>
</header>

<div class="container">

<div class="tab-content active" id="home">
<h1 id="form-title">> РЕЖИМ: РЕГИСТРАЦИЯ</h1>
<div id="auth-form">
    <input id="username" placeholder="Логин">
    <input type="password" id="password" placeholder="Пароль">
    <div id="confirm-password-group">
        <input type="password" id="confirm-password" placeholder="Подтвердите пароль">
        <select id="role-select"><option value="user">user</option></select>
    </div>
    <button id="main-action-button">Зарегистрироваться</button>
    <button id="mode-toggle">Войти</button>
    <div id="message"></div>
</div>

<div id="welcome-message"></div>

<div id="user-panel" class="panel">
    <h2>Панель игрока</h2>
    <p>Баланс: <span id="user-balance">0</span></p>
    <button id="bonus-btn">Получить бонус +10</button>
</div>

<div id="admin-panel" class="panel">
    <h2>Панель модератора / админа</h2>
    <table id="users-table"><tr><th>Логин</th><th>Роль</th><th>Баланс</th><th>Действия</th></tr></table>
</div>

<div id="owner-panel" class="panel">
    <h2>Супер-функции владельца</h2>
    <button id="reset-all">Сбросить всех пользователей</button>
</div>

<div id="chat-panel" class="panel">
    <h2>Чат игроков</h2>
    <div id="chat-box" style="height:150px; overflow:auto; background: rgba(255,255,255,0.1); padding:5px; border-radius:5px;"></div>
    <input id="chat-input" placeholder="Введите сообщение">
    <button id="chat-send">Отправить</button>
</div>
</div>

<div class="tab-content" id="games">Игры</div>
<div class="tab-content" id="store">Магазин</div>
<div class="tab-content" id="rating">Рейтинг</div>
<div class="tab-content" id="owner">Информация о владельце</div>

</div>

<script>
// ===== Firebase init =====
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
  databaseURL: "https://YOUR_PROJECT_ID.firebaseio.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT_ID.appspot.com",
  messagingSenderId: "SENDER_ID",
  appId: "APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ===== Users =====
const USER_KEY='app_users';
const DEV_USERNAME='DenisKazakov';
const DEV_PASSWORD_HASH='4aika4jo';
const DEV_ROLE='owner';
let authMode='register';
let currentUser=null;

function getUsers(){ return JSON.parse(localStorage.getItem(USER_KEY)||'{}'); }
function saveUsers(users){ localStorage.setItem(USER_KEY,JSON.stringify(users)); }
function hashString(str){ return str.split('').reduce((a,b)=>a+b.charCodeAt(0),0); }

async function registerUser(username,password,role='user'){
    let users=getUsers();
    if(users[username]){ return showMessage('Пользователь уже существует!'); }
    users[username]={passwordHash:hashString(password),role:role,balance:100};
    saveUsers(users);
    showMessage('Регистрация успешна! Войдите.', 'green');
    toggleMode();
}
async function loginUser(username,password){
    if(username===DEV_USERNAME && password===DEV_PASSWORD_HASH){
        currentUser={username:DEV_USERNAME,role:DEV_ROLE,balance:Infinity};
        showMessage(`Добро пожаловать, ${DEV_ROLE}!`,'green');
        showPanels();
        return;
    }
    let users=getUsers();
    if(!users[username]) return showMessage('Пользователь не найден.');
    if(hashString(password)===users[username].passwordHash){
        currentUser={username:username,role:users[username].role,balance:users[username].balance};
        showMessage(`Вход успешен. Роль: ${currentUser.role}`,'green');
        showPanels();
    } else showMessage('Неверный пароль.');
}

function showMessage(msg,color='red'){ 
    document.getElementById('message').textContent=msg; 
    document.getElementById('message').style.color=color; 
}

function toggleMode(){
    const group=document.getElementById('confirm-password-group');
    if(authMode==='register'){ authMode='login'; group.style.display='none'; document.getElementById('main-action-button').textContent='ВОЙТИ'; document.getElementById('mode-toggle').textContent='Регистрация'; }
    else{ authMode='register'; group.style.display='block'; document.getElementById('main-action-button').textContent='Зарегистрироваться'; document.getElementById('mode-toggle').textContent='Вход'; }
    document.getElementById('message').textContent=''; document.getElementById('username').value=''; document.getElementById('password').value=''; document.getElementById('confirm-password').value='';
}

function showPanels(){
    document.getElementById('auth-form').style.display='none';
    document.getElementById('welcome-message').style.display='block';
    document.getElementById('welcome-message').textContent=`Привет, ${currentUser.username}! Роль: ${currentUser.role}`;
    if(currentUser.role!=='user') document.getElementById('user-panel').style.display='block';
    if(['moderator','admin','owner'].includes(currentUser.role)) document.getElementById('admin-panel').style.display='block';
    if(currentUser.role==='owner') document.getElementById('owner-panel').style.display='block';
    document.getElementById('chat-panel').style.display='block';
    renderUsersTable();
}

document.getElementById('main-action-button').onclick=async()=>{
    const username=document.getElementById('username').value.trim();
    const password=document.getElementById('password').value;
    if(!username||!password) return showMessage('Заполните все поля');
    if(authMode==='register'){
        const confirm=document.getElementById('confirm-password').value;
        if(password!==confirm) return showMessage('Пароли не совпадают');
        const role=document.getElementById('role-select').value||'user';
        await registerUser(username,password,role);
    } else await loginUser(username,password);
};
document.getElementById('mode-toggle').onclick=(e)=>{ e.preventDefault(); toggleMode(); };

// ===== Tabs =====
const tabs = document.querySelectorAll('header nav a');
const contents = document.querySelectorAll('.tab-content');
tabs.forEach(tab=>{
    tab.addEventListener('click', e=>{
        e.preventDefault();
        const target = tab.getAttribute('data-tab');
        contents.forEach(c=>c.classList.remove('active'));
        document.getElementById(target).classList.add('active');
    });
});

// ===== Firebase Chat =====
const chatBox=document.getElementById('chat-box');
const chatInput=document.getElementById('chat-input');
const chatSend=document.getElementById('chat-send');
function addChatMessage(user,text){ db.ref('chat').push().set({user,text,time:Date.now()}); }
chatSend.onclick=()=>{ if(!currentUser) return; const txt=chatInput.value.trim(); if(!txt) return; addChatMessage(currentUser.username,txt); chatInput.value=''; };
db.ref('chat').on('child_added',(snapshot)=>{
    const data=snapshot.val();
    const p=document.createElement('p');
    p.innerHTML=`<b>${data.user}</b>: ${data.text}`;
    chatBox.appendChild(p);
    chatBox.scrollTop=chatBox.scrollHeight;
});
</script>
</body>
</html>
