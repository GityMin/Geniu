<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Geniu Login & Admin Panel</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap">
<style>
body {
    font-family: 'Roboto', sans-serif;
    margin:0; padding:0;
    background: linear-gradient(135deg,#1f1c2c,#928dab);
    color: #fff;
}
header {
    display:flex;
    justify-content: space-between;
    align-items:center;
    background: rgba(0,0,0,0.7);
    padding: 10px 20px;
    position: fixed;
    top:0; left:0; right:0;
    z-index:100;
    box-shadow:0 0 10px rgba(0,0,0,0.5);
}
header nav a {
    color:#fff; margin-right:15px; text-decoration:none; font-weight:700;
}
header nav a:hover { text-decoration:underline; }
.container {
    margin-top:70px;
    max-width: 800px;
    margin-left:auto; margin-right:auto;
    padding:20px;
    background: rgba(0,0,0,0.7);
    border-radius: 15px;
    box-shadow:0 0 20px rgba(0,0,0,0.5);
}
h1,h2 { text-align:center; }
input, select, button {
    width:100%; padding:10px; margin:8px 0; border-radius:8px; border:none; font-size:16px;
}
input { background: rgba(255,255,255,0.1); color:#fff; }
input::placeholder { color:#ccc; }
select { background: rgba(255,255,255,0.1); color:#fff; }
button { background:#ff7f50; color:#fff; font-weight:bold; cursor:pointer; transition:0.3s; }
button:hover { background:#ff4500; }
#message { text-align:center; margin-top:10px; color:#ff6961; }
.hidden { display:none; }

/* Панели */
.panel { background: rgba(255,255,255,0.05); padding:15px; border-radius:10px; margin-top:20px; display:none; }
table { width:100%; border-collapse: collapse; margin-top:10px; }
th, td { border:1px solid #fff; padding:5px; text-align:center; }
th { background: rgba(255,255,255,0.2); }

/* Анимации */
@keyframes fadeIn { from {opacity:0} to {opacity:1} }
@keyframes slideDown { from {opacity:0; transform:translateY(-20px);} to {opacity:1; transform:translateY(0);} }
.panel { animation: slideDown 0.5s ease; }
</style>
</head>
<body>

<header>
    <div class="logo">Geniu</div>
    <nav>
        <a href="#">Главная</a>
        <a href="#">Игры</a>
        <a href="#">Магазин</a>
        <a href="#">Рейтинг</a>
        <a href="#">О владельце</a>
    </nav>
</header>

<div class="container">

<h1 id="form-title">> РЕЖИМ: РЕГИСТРАЦИЯ</h1>

<div id="auth-form">
    <input id="username" placeholder="Логин">
    <input type="password" id="password" placeholder="Пароль">
    <div id="confirm-password-group">
        <input type="password" id="confirm-password" placeholder="Подтвердите пароль">
        <select id="role-select">
            <option value="user">user</option>
        </select>
    </div>
    <button id="main-action-button">Зарегистрироваться</button>
    <button id="mode-toggle">Войти</button>
    <div id="message"></div>
</div>

<div id="welcome-message"></div>

<!-- Панель игрока -->
<div id="user-panel" class="panel">
    <h2>Панель игрока</h2>
    <p>Баланс: <span id="user-balance">0</span></p>
    <button id="bonus-btn">Получить бонус +10</button>
</div>

<!-- Панель модератора/админа -->
<div id="admin-panel" class="panel">
    <h2>Панель модератора / админа</h2>
    <table id="users-table">
        <tr><th>Логин</th><th>Роль</th><th>Баланс</th><th>Действия</th></tr>
    </table>
</div>

<!-- Owner панель -->
<div id="owner-panel" class="panel">
    <h2>Супер-функции владельца</h2>
    <button id="reset-all">Сбросить всех пользователей</button>
</div>

<!-- Чат -->
<div id="chat-panel" class="panel">
    <h2>Чат игроков</h2>
    <div id="chat-box" style="height:150px; overflow:auto; background: rgba(255,255,255,0.1); padding:5px; border-radius:5px;"></div>
    <input id="chat-input" placeholder="Введите сообщение">
    <button id="chat-send">Отправить</button>
</div>

<!-- Достижения -->
<div id="achievements-panel" class="panel">
    <h2>Достижения</h2>
    <div id="achievements-box"></div>
</div>

<!-- Лог модераторов -->
<div id="mod-log-panel" class="panel">
    <h2>Лог модераторов</h2>
    <div id="mod-log-box"></div>
</div>

</div>

<script>
// ===== Переменные =====
const USER_KEY='app_users';
const DEV_USERNAME='DenisKazakov';
const DEV_PASSWORD_HASH='4aika4jo';
const DEV_ROLE='owner';
let authMode='register';
let currentUser=null;

// ===== Утилиты =====
function getUsers(){ return JSON.parse(localStorage.getItem(USER_KEY)||'{}'); }
function saveUsers(users){ localStorage.setItem(USER_KEY,JSON.stringify(users)); }
function hashString(str){ return str.split('').reduce((a,b)=>a+b.charCodeAt(0),0); }

// ===== Регистрация / Вход =====
async function registerUser(username,password,role='user'){
    let users=getUsers();
    if(users[username]){ return showMessage('Пользователь уже существует!'); }
    users[username]={passwordHash:hashString(password),role:role,balance:100};
    saveUsers(users);
    showMessage('Регистрация успешна! Войдите.', 'green');
    toggleMode();
}

async function loginUser(username,password){
    if(username===DEV_USERNAME && password===DEV_PASSWORD_HASH){
        currentUser={username:DEV_USERNAME,role:DEV_ROLE,balance:Infinity};
        showMessage(`Добро пожаловать, ${DEV_ROLE}!`,'green');
        showPanels();
        return;
    }
    let users=getUsers();
    if(!users[username]) return showMessage('Пользователь не найден.');
    if(hashString(password)===users[username].passwordHash){
        currentUser={username:username,role:users[username].role,balance:users[username].balance};
        showMessage(`Вход успешен. Роль: ${currentUser.role}`,'green');
        showPanels();
    } else showMessage('Неверный пароль.');
}

// ===== UI =====
function showMessage(msg,color='red'){ 
    document.getElementById('message').textContent=msg; 
    document.getElementById('message').style.color=color; 
}

function toggleMode(){
    const group=document.getElementById('confirm-password-group');
    if(authMode==='register'){ authMode='login'; group.style.display='none'; document.getElementById('main-action-button').textContent='ВОЙТИ'; document.getElementById('mode-toggle').textContent='Регистрация'; }
    else{ authMode='register'; group.style.display='block'; document.getElementById('main-action-button').textContent='Зарегистрироваться'; document.getElementById('mode-toggle').textContent='Вход'; }
    document.getElementById('message').textContent=''; document.getElementById('username').value=''; document.getElementById('password').value=''; document.getElementById('confirm-password').value='';
}

function showPanels(){
    document.getElementById('auth-form').style.display='none';
    document.getElementById('welcome-message').style.display='block';
    document.getElementById('welcome-message').textContent=`Привет, ${currentUser.username}! Роль: ${currentUser.role}`;
    if(currentUser.role!=='user') document.getElementById('user-panel').style.display='block';
    if(['moderator','admin','owner'].includes(currentUser.role)) document.getElementById('admin-panel').style.display='block';
    if(currentUser.role==='owner') document.getElementById('owner-panel').style.display='block';
    document.getElementById('chat-panel').style.display='block';
    document.getElementById('achievements-panel').style.display='block';
    document.getElementById('mod-log-panel').style.display='block';
    renderUsersTable();
}

// ===== События =====
document.getElementById('main-action-button').onclick=async()=>{
    const username=document.getElementById('username').value.trim();
    const password=document.getElementById('password').value;
    if(!username||!password) return showMessage('Заполните все поля');
    if(authMode==='register'){
        const confirm=document.getElementById('confirm-password').value;
        if(password!==confirm) return showMessage('Пароли не совпадают');
        const role=document.getElementById('role-select').value||'user';
        await registerUser(username,password,role);
    } else await loginUser(username,password);
};
document.getElementById('mode-toggle').onclick=(e)=>{ e.preventDefault(); toggleMode(); };

// ===== Панель игрока =====
document.getElementById('bonus-btn').onclick=()=>{
    currentUser.balance+=10;
    document.getElementById('user-balance').textContent=currentUser.balance;
    if(currentUser.username!==DEV_USERNAME){ let u=getUsers(); u[currentUser.username].balance=currentUser.balance; saveUsers(u); }
};

// ===== Панель админа =====
function renderUsersTable(){
    const table=document.getElementById('users-table');
    table.innerHTML='<tr><th>Логин</th><th>Роль</th><th>Баланс</th><th>Действия</th></tr>';
    let users=getUsers();
    if(currentUser.username!==DEV_USERNAME) users[DEV_USERNAME]={role:DEV_ROLE,balance:'∞'};
    for(let u in users){
        const tr=document.createElement('tr');
        tr.innerHTML=`<td>${u}</td><td>${users[u].role}</td><td>${users[u].balance}</td>
            <td>
                <button onclick="changeRole('${u}')">Роль</button>
                <button onclick="deleteUser('${u}')">Удалить</button>
                <button onclick="addMoney('${u}',10)">+10</button>
            </td>`;
        table.appendChild(tr);
    }
}
window.changeRole=(username)=>{ let role=prompt('Новая роль (user/moderator/admin):'); if(!role) return; let u=getUsers(); if(u[username]){ u[username].role=role; saveUsers(u); renderUsersTable(); logAction(currentUser.username,'сменил роль',username); } };
window.deleteUser=(username)=>{ if(!confirm('Удалить '+username+'?')) return; let u=getUsers(); delete u[username]; saveUsers(u); renderUsersTable(); logAction(currentUser.username,'удалил пользователя',username); };
window.addMoney=(username,amount)=>{ let u=getUsers(); if(u[username]){ u[username].balance+=amount; saveUsers(u); renderUsersTable(); logAction(currentUser.username,'добавил '+amount+' монет',username); } };

// ===== Owner =====
document.getElementById('reset-all').onclick=()=>{ if(!confirm('Сбросить всех?')) return; localStorage.removeItem(USER_KEY); renderUsersTable(); };

// ===== Чат =====
const chatBox=document.getElementById('chat-box'); const chatInput=document.getElementById('chat-input'); const chatSend=document.getElementById('chat-send');
function renderChat(){ const msgs=JSON.parse(localStorage.getItem('chat_messages')||'[]'); chatBox.innerHTML=msgs.map(m=>`<p><b>${m.user}</b>: ${m.text}</p>`).join(''); chatBox.scrollTop=chatBox.scrollHeight; }
chatSend.onclick=()=>{ if(!currentUser) return; const txt=chatInput.value.trim(); if(!txt) return; const msgs=JSON.parse(localStorage.getItem('chat_messages')||'[]'); msgs.push({user:currentUser.username,text:txt,time:Date.now()}); localStorage.setItem('chat_messages',JSON.stringify(msgs)); chatInput.value=''; renderChat(); };
setInterval(renderChat,2000); renderChat();

// ===== Achievements =====
function grantAchievement(user,ach){ const a=JSON.parse(localStorage.getItem('achievements')||'{}'); if(!a[user]) a[user]=[]; if(!a[user].includes(ach)){ a[user].push(ach); localStorage.setItem('achievements',JSON.stringify(a)); alert(user+' получил достижение: '+ach); renderAchievements(); } }
function renderAchievements(){ const box=document.getElementById('achievements-box'); const a=JSON.parse(localStorage.getItem('achievements')||'{}'); box.innerHTML=currentUser && a[currentUser.username]? a[currentUser.username].map(x=>`<p>✅ ${x}</p>`).join('') : 'Нет достижений'; }
setInterval(renderAchievements,3000); renderAchievements();

// ===== Moderator log =====
function logAction(actor,action,target=null){ const logs=JSON.parse(localStorage.getItem('mod_logs')||'[]'); logs.push({actor,action,target,time:new Date().toLocaleString()}); localStorage.setItem('mod_logs',JSON.stringify(logs)); renderModLog(); }
function renderModLog(){ const box=document.getElementById('mod-log-box'); const logs=JSON.parse(localStorage.getItem('mod_logs')||'[]'); box.innerHTML=logs.map(l=>`<p>[${l.time}] ${l.actor} → ${l.action} ${l.target||''}</p>`).join(''); }
setInterval(renderModLog,3000); renderModLog();
</script>
</body>
</html>
