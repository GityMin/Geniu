<!DOCTYPE html>
<html lang="ru">
<head>
    <title>–ë–ª—ç–∫–¥–∂–µ–∫ | –î–µ–Ω–∏—Å –ö–∞–∑–∞–∫–æ–≤</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /* –ì–õ–û–ë–ê–õ–¨–ù–´–ï –°–¢–ò–õ–ò */
        body { 
            font-family: 'Arial', sans-serif; 
            background-color: #0d0d0d; 
            color: #E0E0E0; 
            text-align: center; 
            padding-top: 50px; 
        }
        .nav-bar { 
            background-color: #333; 
            padding: 10px 0; 
            margin-bottom: 30px; 
        }
        .nav-bar a { 
            color: #fff; 
            padding: 14px 20px; 
            text-decoration: none; 
            font-size: 18px; 
            font-weight: bold; 
        }
        .nav-bar a:hover { 
            background-color: #575757; 
        }
        h1 { 
            color: #00FFFF; 
            text-shadow: 0 0 10px #00FFFF; 
        }

        /* –ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ */
        .game-container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #1a1a1a;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #00FFFF;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.4);
        }

        /* –ö–∞—Ä—Ç—ã –∏ –∏–≥—Ä–æ–∫–∏ */
        .player-area {
            margin-bottom: 30px;
            padding: 10px;
            border-bottom: 1px solid #333;
        }
        .cards {
            display: flex;
            justify-content: center;
            min-height: 100px; 
        }
        .card {
            background-color: white;
            color: black;
            border: 1px solid #000;
            width: 70px;
            height: 90px;
            line-height: 90px;
            margin: 0 5px;
            border-radius: 5px;
            font-size: 1.5em;
            font-weight: bold;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5);
        }
        .card.hidden {
            background-color: #FF4500;
            color: white;
            content: '‚ùì';
            line-height: 90px;
            font-size: 1em;
        }

        /* –ü–∞–Ω–µ–ª—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏ –±–∞–ª–∞–Ω—Å */
        .info-panel { 
            display: flex; 
            justify-content: space-around; 
            align-items: center;
            margin-bottom: 20px; 
        }
        #money-display { 
            font-size: 2em; 
            color: #00FF00; 
            font-weight: bold;
            text-shadow: 0 0 5px #00FF00;
        }
        
        /* –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ */
        .controls {
            margin-top: 30px;
        }
        .controls button {
            padding: 12px 25px;
            font-size: 1.1em;
            margin: 5px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background-color: #008080;
            color: white;
            transition: background-color 0.2s;
        }
        .controls button:hover:not(:disabled) {
            background-color: #00BFFF;
        }
        .controls button:disabled {
            background-color: #444;
            cursor: not-allowed;
            color: #AAA;
        }

        /* –°—Ç–∞–≤–∫–∞ */
        .bet-control {
            margin-bottom: 20px;
        }
        #bet-input {
            padding: 8px; 
            font-size: 1em; 
            width: 60px; 
            text-align: center; 
            border: 2px solid #00FFFF; 
            background-color: #222; 
            color: white; 
            border-radius: 5px; 
        }

        /* –°–æ–æ–±—â–µ–Ω–∏–µ */
        #game-message {
            font-size: 1.8em;
            margin-top: 20px;
            min-height: 40px;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 0 0 5px #FFD700;
        }
        
        /* --- –°–¢–ò–õ–ò –î–õ–Ø –ö–õ–ò–ö–ï–†–ê --- */
        .clicker-panel {
            max-width: 400px;
            margin: 40px auto;
            padding: 20px;
            background-color: #2a2a2a;
            border-radius: 10px;
            border: 2px solid #FFD700;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
        }
        .clicker-panel h2 {
            color: #FFD700;
            text-shadow: 0 0 5px #FFD700;
            margin-top: 0;
        }
        #clicker-button {
            padding: 15px 30px;
            font-size: 1.5em;
            background-color: #FFD700;
            color: #111;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.1s, transform 0.1s, box-shadow 0.1s;
            box-shadow: 0 5px #C4A100;
        }
        #clicker-button:active {
            transform: translateY(3px);
            box-shadow: 0 2px #C4A100;
        }
        #clicker-message {
            margin-top: 15px;
            font-weight: bold;
            color: #EEE;
        }

        /* –ú–û–ë–ò–õ–¨–ù–ê–Ø –ê–î–ê–ü–¢–ê–¶–ò–Ø */
        @media (max-width: 600px) {
            .card { width: 50px; height: 70px; line-height: 70px; font-size: 1.2em; }
            .info-panel { flex-direction: column; gap: 10px; }
            #money-display { font-size: 1.5em; }
        }
    </style>
</head>
<body>
    <div class="nav-bar">
        <a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a>
        <a href="games.html">–ò–≥—Ä—ã</a>
        <a href="about.html">–ê–≤—Ç–æ—Ä</a>
        <a href="login.html">–í—Ö–æ–¥/–í—ã—Ö–æ–¥</a>
    </div>

    <h1>‚ô¶Ô∏è –ë–ª—ç–∫–¥–∂–µ–∫ "–û—á–∫–æ –ì–µ–Ω–∏—è" ‚ô¶Ô∏è</h1>

    <div class="game-container">
        <div class="info-panel">
            <div id="money-display">–ë–∞–ª–∞–Ω—Å: 0</div>
            <div class="bet-control">
                <label for="bet-input">–°—Ç–∞–≤–∫–∞:</label>
                <input type="number" id="bet-input" value="10" min="1" step="1">
            </div>
        </div>

        <div class="player-area" id="dealer-area">
            <h2>–î–∏–ª–µ—Ä (<span id="dealer-score">0</span>)</h2>
            <div class="cards" id="dealer-cards"></div>
        </div>

        <div class="player-area" id="player-area">
            <h2>–¢–≤–æ–π —Å—á–µ—Ç (<span id="player-score">0</span>)</h2>
            <div class="cards" id="player-cards"></div>
        </div>

        <p id="game-message">–ù–∞–∂–º–∏—Ç–µ "–ù–∞—á–∞—Ç—å –ò–≥—Ä—É", —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É.</p>

        <div class="controls">
            <button id="deal-button">–ù–∞—á–∞—Ç—å –ò–≥—Ä—É</button>
            <button id="hit-button" disabled>–í–∑—è—Ç—å –ö–∞—Ä—Ç—É (Hit)</button>
            <button id="stand-button" disabled>–•–≤–∞—Ç–∏—Ç (Stand)</button>
        </div>
    </div>

    <div class="clicker-panel">
        <h2>‚ö° –ö–ª–∏–∫–µ—Ä –ú–∞–Ω–∏ (–ü–æ–ª—É—á–∏ —Å—Ç–∞—Ä—Ç–æ–≤—ã–π –∫–∞–ø–∏—Ç–∞–ª!) ‚ö°</h2>
        <button id="clicker-button">–ö–ª–∏–∫–Ω—É—Ç—å –∑–∞ 1 –ú–∞–Ω–∏!</button>
        <p id="clicker-message">–ö–∞–∂–¥—ã–π –∫–ª–∏–∫ –ø—Ä–∏–Ω–æ—Å–∏—Ç 1 –ú–∞–Ω–∏. –ò—Å–ø–æ–ª—å–∑—É–π —ç—Ç–æ!</p>
    </div>
    <script>
        window.onload = function() {
            // --- –≠–ª–µ–º–µ–Ω—Ç—ã DOM ---
            const MONEY_DISPLAY = document.getElementById('money-display');
            const BET_INPUT = document.getElementById('bet-input');
            const DEAL_BUTTON = document.getElementById('deal-button');
            const HIT_BUTTON = document.getElementById('hit-button');
            const STAND_BUTTON = document.getElementById('stand-button');
            const MESSAGE = document.getElementById('game-message');
            const PLAYER_CARDS_DIV = document.getElementById('player-cards');
            const DEALER_CARDS_DIV = document.getElementById('dealer-cards');
            const PLAYER_SCORE_SPAN = document.getElementById('player-score');
            const DEALER_SCORE_SPAN = document.getElementById('dealer-score');

            const CLICKER_BUTTON = document.getElementById('clicker-button');
            const CLICKER_MESSAGE = document.getElementById('clicker-message');

            // --- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–≥—Ä—ã ---
            let deck = [];
            let playerCards = [];
            let dealerCards = [];
            let betAmount = 0;
            let gameStarted = false;

            // --- –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò ---
            const currentUsername = localStorage.getItem('denisKazakovUser');
            const isUserLoggedIn = !!currentUsername;
            
            // --- –§–£–ù–ö–¶–ò–ò –ë–ê–õ–ê–ù–°–ê –° –ü–†–ò–í–Ø–ó–ö–û–ô –ö –õ–û–ì–ò–ù–£ ---
            const SECRET_KEY = 952; 
            const MONEY_PREFIX = 'money_';
            const CHECKSUM_PREFIX = 'checksum_';

            function getMoneyKey(username) { return MONEY_PREFIX + username; }
            function getChecksumKey(username) { return CHECKSUM_PREFIX + username; }

            function getMoney() {
                if (!isUserLoggedIn) return 0;
                
                const moneyKey = getMoneyKey(currentUsername);
                const checksumKey = getChecksumKey(currentUsername);

                const storedMoney = parseInt(localStorage.getItem(moneyKey)) || 100;
                const storedChecksum = parseInt(localStorage.getItem(checksumKey)) || (storedMoney + SECRET_KEY);

                if (storedMoney + SECRET_KEY !== storedChecksum) {
                    console.warn("–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –ø–æ–ø—ã—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞. –ë–∞–ª–∞–Ω—Å —Å–±—Ä–æ—à–µ–Ω.");
                    return setMoney(10); 
                }
                return storedMoney;
            }

            function setMoney(amount) {
                if (!isUserLoggedIn) {
                    updateControls();
                    return 0;
                }

                const moneyKey = getMoneyKey(currentUsername);
                const checksumKey = getChecksumKey(currentUsername);
                
                const safeAmount = Math.max(10, amount);
                const newChecksum = safeAmount + SECRET_KEY;
                
                localStorage.setItem(moneyKey, safeAmount);
                localStorage.setItem(checksumKey, newChecksum);
                
                MONEY_DISPLAY.textContent = `–ë–∞–ª–∞–Ω—Å: ${safeAmount} –ú–∞–Ω–∏`;
                updateControls();
                
                return safeAmount;
            }

            // --- –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø –ë–õ–û–ö–ò–†–û–í–ö–ò –ö–ù–û–ü–û–ö ---
            function updateControls() {
                const currentMoney = getMoney();
                const bet = parseInt(BET_INPUT.value);
                
                if (!isUserLoggedIn) {
                    MONEY_DISPLAY.textContent = '–ë–∞–ª–∞–Ω—Å: üîí –í–æ–π–¥–∏!';
                    MESSAGE.textContent = '–í–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç, —á—Ç–æ–±—ã –∏–≥—Ä–∞—Ç—å –Ω–∞ –ú–∞–Ω–∏!';
                    
                    BET_INPUT.disabled = true;
                    DEAL_BUTTON.disabled = true;
                    HIT_BUTTON.disabled = true;
                    STAND_BUTTON.disabled = true;
                    return;
                }

                // –õ–æ–≥–∏–∫–∞ –∏–≥—Ä—ã (–µ—Å–ª–∏ –≤–æ—à–ª–∏)
                BET_INPUT.disabled = gameStarted;
                DEAL_BUTTON.disabled = gameStarted || currentMoney < bet || bet <= 0;
                HIT_BUTTON.disabled = !gameStarted;
                STAND_BUTTON.disabled = !gameStarted;
                
                if (!gameStarted && DEAL_BUTTON.disabled && currentMoney > 0) {
                    MESSAGE.textContent = '–°—Ç–∞–≤–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±–æ–ª—å—à–µ 0 –∏ –Ω–µ –ø—Ä–µ–≤—ã—à–∞—Ç—å –±–∞–ª–∞–Ω—Å.';
                } else if (!gameStarted) {
                    MESSAGE.textContent = '–ù–∞–∂–º–∏—Ç–µ "–ù–∞—á–∞—Ç—å –ò–≥—Ä—É", —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É.';
                }
            }
            // --- –ö–û–ù–ï–¶ –ù–û–í–û–ô –§–£–ù–ö–¶–ò–ò ---
            
            // --- –§–£–ù–ö–¶–ò–ò –ö–õ–ò–ö–ï–†–ê ---
            function handleCick() {
                if (!isUserLoggedIn) {
                    CLICKER_MESSAGE.textContent = '–í—ã –Ω–µ –≤–æ—à–ª–∏. –í–∞—à–∏ –ú–∞–Ω–∏ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è! –í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –∫–æ–ø–∏—Ç—å!';
                    CLICKER_MESSAGE.style.color = '#FFD700';
                    return;
                }

                setMoney(getMoney() + 1);
                CLICKER_BUTTON.textContent = `–ö–ª–∏–∫–Ω—É—Ç—å –∑–∞ 1 –ú–∞–Ω–∏! (–ë–∞–ª–∞–Ω—Å: ${getMoney()})`;
                CLICKER_MESSAGE.textContent = `+1 –ú–∞–Ω–∏! –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å: ${getMoney()} –ú–∞–Ω–∏`;
                CLICKER_MESSAGE.style.color = '#00FF00';
            }
            CLICKER_BUTTON.addEventListener('click', handleCick);
            // --- –ö–û–ù–ï–¶ –§–£–ù–ö–¶–ò–ô –ö–õ–ò–ö–ï–†–ê ---


            // --- –õ–æ–≥–∏–∫–∞ –ë–ª—ç–∫–¥–∂–µ–∫–∞ ---
            const CARD_VALUES = { '2': 2, '3': 3, '4': 4, '5': 5, '6': 6, '7': 7, '8': 8, '9': 9, '10': 10, 'J': 10, 'Q': 10, 'K': 10, 'A': 11 };
            const SUITS = ['‚ô†Ô∏è', '‚ô•Ô∏è', '‚ô¶Ô∏è', '‚ô£Ô∏è'];
            const RANKS = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];

            function createDeck() {
                let newDeck = [];
                for (let suit of SUITS) {
                    for (let rank of RANKS) {
                        newDeck.push({ rank: rank, suit: suit, value: CARD_VALUES[rank] });
                    }
                }
                // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏–µ (Fisher-Yates)
                for (let i = newDeck.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [newDeck[i], newDeck[j]] = [newDeck[j], newDeck[i]];
                }
                return newDeck;
            }

            function getScore(cards) {
                let score = cards.reduce((sum, card) => sum + card.value, 0);
                let aceCount = cards.filter(card => card.rank === 'A').length;

                while (score > 21 && aceCount > 0) {
                    score -= 10;
                    aceCount--;
                }
                return score;
            }

            function drawCard(cards, isHidden = false) {
                const cardData = deck.pop();
                if (!cardData) return;
                
                cards.push(cardData);

                const cardDiv = document.createElement('div');
                cardDiv.className = 'card';
                cardDiv.textContent = cardData.rank + cardData.suit;
                
                if (isHidden) {
                    cardDiv.classList.add('hidden');
                    cardDiv.textContent = '‚ùì';
                }
                
                const targetDiv = (cards === playerCards) ? PLAYER_CARDS_DIV : DEALER_CARDS_DIV;
                targetDiv.appendChild(cardDiv);
            }

            function showAllCards() {
                DEALER_CARDS_DIV.innerHTML = '';
                for (let card of dealerCards) {
                    const cardDiv = document.createElement('div');
                    cardDiv.className = 'card';
                    cardDiv.textContent = card.rank + card.suit;
                    DEALER_CARDS_DIV.appendChild(cardDiv);
                }
            }

            function startGame() {
                betAmount = parseInt(BET_INPUT.value);
                const currentMoney = getMoney();
                
                if (!isUserLoggedIn || currentMoney < betAmount || betAmount <= 0) {
                    MESSAGE.textContent = "–û—à–∏–±–∫–∞: –í–æ–π–¥–∏—Ç–µ –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞–≤–∫—É/–±–∞–ª–∞–Ω—Å.";
                    updateControls();
                    return;
                }

                setMoney(currentMoney - betAmount); 

                gameStarted = true;
                deck = createDeck();
                playerCards = [];
                dealerCards = [];

                PLAYER_CARDS_DIV.innerHTML = '';
                DEALER_CARDS_DIV.innerHTML = '';
                
                drawCard(playerCards);
                drawCard(dealerCards);
                drawCard(playerCards);
                drawCard(dealerCards, true); 

                PLAYER_SCORE_SPAN.textContent = getScore(playerCards);
                DEALER_SCORE_SPAN.textContent = getScore([dealerCards[0]]);

                updateControls();
                
                if (getScore(playerCards) === 21) {
                    endGame(true, "‚ô¶Ô∏è –ë–õ–≠–ö–î–ñ–ï–ö! –¢–´ –í–´–ò–ì–†–ê–õ(–ê)! ‚ô¶Ô∏è", betAmount * 2.5);
                    return;
                }

                MESSAGE.textContent = '–í–∑—è—Ç—å –µ—â–µ –∫–∞—Ä—Ç—É –∏–ª–∏ —Ö–≤–∞—Ç–∏—Ç?';
            }

            function hit() {
                drawCard(playerCards);
                const score = getScore(playerCards);
                PLAYER_SCORE_SPAN.textContent = score;

                if (score > 21) {
                    endGame(false, "üí• –ü–ï–†–ï–ë–û–†! –¢–´ –ü–†–û–ò–ì–†–ê–õ(–ê)!", 0);
                }
                updateControls();
            }

            async function stand() {
                showAllCards();
                let dealerScore = getScore(dealerCards);
                DEALER_SCORE_SPAN.textContent = dealerScore;
                MESSAGE.textContent = '–•–æ–¥ –î–∏–ª–µ—Ä–∞...';

                while (dealerScore < 17) {
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    drawCard(dealerCards);
                    dealerScore = getScore(dealerCards);
                    DEALER_SCORE_SPAN.textContent = dealerScore;
                }

                await new Promise(resolve => setTimeout(resolve, 1000));
                
                const playerScore = getScore(playerCards);
                let win = false;
                let winText = "";
                let prize = 0;

                if (dealerScore > 21) {
                    win = true;
                    winText = "‚úÖ –î–ò–õ–ï–† –ü–ï–†–ï–ë–û–†! –¢–´ –í–´–ò–ì–†–ê–õ(–ê)!";
                    prize = betAmount * 2;
                } else if (playerScore > dealerScore) {
                    win = true;
                    winText = "üéâ –¢–´ –í–´–ò–ì–†–ê–õ(–ê)!";
                    prize = betAmount * 2;
                } else if (playerScore < dealerScore) {
                    win = false;
                    winText = "üò≠ –î–ò–õ–ï–† –ü–û–ë–ï–î–ò–õ!";
                    prize = 0;
                } else {
                    win = true; 
                    winText = "ü§ù –ù–ò–ß–¨–Ø (PUSH)! –°—Ç–∞–≤–∫–∞ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∞.";
                    prize = betAmount;
                }

                endGame(win, winText, prize);
            }

            function endGame(winStatus, messageText, prizeAmount) {
                gameStarted = false;
                
                MESSAGE.textContent = messageText + (prizeAmount > 0 ? ` (+${prizeAmount} –ú–∞–Ω–∏)` : '');
                MESSAGE.style.color = winStatus ? '#00FF00' : '#FF0000';
                
                setMoney(getMoney() + prizeAmount); 
                
                updateControls(); 
            }

            // --- Event Listeners and Initialization ---
            DEAL_BUTTON.addEventListener('click', startGame);
            HIT_BUTTON.addEventListener('click', hit);
            STAND_BUTTON.addEventListener('click', stand);
            BET_INPUT.addEventListener('input', updateControls);

            setMoney(getMoney()); 
            updateControls();
        };
    </script>
</body>
</html>
