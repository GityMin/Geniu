<!DOCTYPE html>
<html lang="ru">
<head>
    <title>–°–õ–û–¢–´ | [–°–ò–°–¢–ï–ú–ê] –ò–ì–†–û–í–ê–Ø –ó–û–ù–ê</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        /* –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï */
        :root {
            --bg-color: #0A0A0A; 
            --text-color: #F0F0F0; 
            --accent-pink: #FF33CC; 
            --accent-blue: #33CCFF; 
            --card-bg: #181818; 
            --win-color: #00FF00;
            --jackpot-color: #FFFF00;
            --loss-color: #FF0000;
            --reel-size: 100px; /* –†–∞–∑–º–µ—Ä —Å–∏–º–≤–æ–ª–∞ */
            --visible-rows: 3; /* –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–¥–∏–º—ã—Ö —Ä—è–¥–æ–≤ */
        }

        /* –û–°–ù–û–í–ù–´–ï –°–¢–ò–õ–ò */
        body { 
            font-family: 'Orbitron', sans-serif; 
            background-color: var(--bg-color); 
            color: var(--text-color); 
            text-align: center; 
            padding-top: 80px; 
            margin: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-image: radial-gradient(circle at center, rgba(255, 51, 204, 0.1) 0%, transparent 50%);
        }
        
        /* –ù–ê–í–ò–ì–ê–¶–ò–Ø */
        .nav-bar { 
            background-color: #000000;
            padding: 15px 0; 
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5), 0 0 10px var(--accent-blue);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
        }
        .nav-bar a { 
            color: var(--text-color); 
            padding: 14px 25px; 
            text-decoration: none; 
            font-size: 16px; 
            font-weight: 700; 
            transition: color 0.3s, text-shadow 0.3s;
            border-radius: 5px;
        }
        .nav-bar a:hover { 
            color: var(--accent-pink); 
            text-shadow: 0 0 10px var(--accent-pink); 
        }

        h1 { 
            color: var(--accent-pink); 
            font-size: 3em; 
            font-weight: 900;
            text-shadow: 0 0 25px rgba(255, 51, 204, 1); 
            margin-bottom: 40px;
        }
        
        /* –ö–û–ù–¢–ï–ô–ù–ï–† –°–õ–û–¢–û–í */
        .slot-container {
            width: 90%;
            max-width: 650px;
            background-color: var(--card-bg);
            border: 4px solid var(--accent-blue);
            box-shadow: 0 0 30px rgba(51, 204, 255, 0.5);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            position: relative;
        }

        /* –î–ò–°–ü–õ–ï–ô –ë–ê–õ–ê–ù–°–ê */
        #balance-display {
            color: var(--jackpot-color);
            font-size: 1.5em;
            margin-bottom: 20px;
            border: 2px dashed var(--jackpot-color);
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.3);
            text-shadow: 0 0 10px var(--jackpot-color);
        }

        /* –ü–û–õ–ï –°–õ–û–¢–û–í (–ë–∞—Ä–∞–±–∞–Ω—ã) */
        #slot-reels {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            
            /* –ü–°–ï–í–î–û-3D –≠–§–§–ï–ö–¢ */
            transform-style: preserve-3d;
            perspective: 800px;
        }

        /* –†–ê–ú–ö–ê –ë–ê–†–ê–ë–ê–ù–ê (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 3 —Å–∏–º–≤–æ–ª–∞) */
        .reel-frame {
            width: var(--reel-size);
            height: calc(var(--reel-size) * var(--visible-rows)); /* 300px */
            background-color: #000;
            border: 3px solid var(--accent-pink);
            border-radius: 5px;
            overflow: hidden; /* –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ 3 —Å–∏–º–≤–æ–ª–∞ */
            box-shadow: 0 0 15px var(--accent-pink), 0 0 5px var(--accent-blue) inset;
            
            /* –ù–∞–∫–ª–æ–Ω –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞ –º–∞—à–∏–Ω—ã */
            transform: rotateX(10deg);
            position: relative;
        }
        
        /* –ò–ù–î–ò–ö–ê–¢–û–† –í–´–ò–ì–†–´–®–ù–û–ô –õ–ò–ù–ò–ò (–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Ä—è–¥) */
        .reel-frame::after {
            content: '';
            position: absolute;
            top: var(--reel-size); /* –ù–∞—á–∞–ª–æ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–≥–æ —Ä—è–¥–∞ */
            height: var(--reel-size);
            width: 100%;
            /* –í–∏–∑—É–∞–ª—å–Ω–∞—è —Ä–∞–º–∫–∞ –¥–ª—è –≤—ã–∏–≥—Ä—ã—à–Ω–æ–π –ª–∏–Ω–∏–∏ */
            border-top: 3px solid var(--jackpot-color);
            border-bottom: 3px solid var(--jackpot-color);
            opacity: 0.6;
            pointer-events: none;
            z-index: 5; 
        }

        /* –≠–ª–µ–º–µ–Ω—Ç—ã –≤–Ω—É—Ç—Ä–∏ –±–∞—Ä–∞–±–∞–Ω–∞ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ */
        .reel-inner {
            /* Transform —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –≤ JS, –Ω–æ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 0px –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞ */
            transform: translateY(0); 
            will-change: transform; 
        }
        
        /* –°–¢–ò–õ–¨ –°–ò–ú–í–û–õ–û–í (–ò–°–ü–†–ê–í–õ–ï–ù–û: —É–±—Ä–∞–Ω—ã —Å—Ç–∏–ª–∏, –±–ª–æ–∫–∏—Ä—É—é—â–∏–µ —Ü–≤–µ—Ç —ç–º–æ–¥–∑–∏) */
        .reel-inner div {
            height: var(--reel-size);
            line-height: var(--reel-size);
            font-size: 3em;
            /* –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –±—Ä–∞—É–∑–µ—Ä –º–æ–∂–µ—Ç –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Ü–≤–µ—Ç–Ω—ã–µ —ç–º–æ–¥–∑–∏ */
            color: initial; 
            text-shadow: none; 
        }
        
        /* –£–ü–†–ê–í–õ–ï–ù–ò–ï –ò–ì–†–û–ô */
        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-top: 20px;
        }

        .action-button {
            padding: 15px 30px;
            background-color: var(--accent-blue);
            color: var(--bg-color);
            border: none;
            border-radius: 5px;
            font-family: 'Orbitron', sans-serif;
            font-size: 1.2em;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 0 15px var(--accent-blue);
            transition: background-color 0.2s, box-shadow 0.2s, transform 0.1s;
        }
        .action-button:hover:not(:disabled) {
            background-color: var(--accent-pink);
            box-shadow: 0 0 20px var(--accent-pink);
            color: var(--text-color);
        }
        .action-button:active:not(:disabled) {
            transform: scale(0.98);
        }
        .action-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* –ò–ù–ü–£–¢ –°–¢–ê–í–ö–ò */
        #bet-input {
            width: 100px;
            padding: 10px;
            text-align: center;
            background-color: #000;
            color: var(--win-color);
            border: 2px solid var(--accent-blue);
            border-radius: 4px;
            font-family: 'Orbitron', sans-serif;
            font-size: 1em;
        }

        /* –°–û–û–ë–©–ï–ù–ò–Ø */
        #message-display {
            font-size: 1.4em;
            min-height: 30px;
            margin-top: 20px;
            font-weight: 700;
        }
        .win { color: var(--win-color); text-shadow: 0 0 10px var(--win-color); }
        .jackpot { color: var(--jackpot-color); text-shadow: 0 0 15px var(--jackpot-color), 0 0 25px var(--jackpot-color); animation: pulse-jackpot 1s infinite alternate; }
        .loss { color: var(--loss-color); text-shadow: 0 0 10px var(--loss-color); }
        .info { color: var(--accent-blue); text-shadow: 0 0 10px var(--accent-blue); }

        @keyframes pulse-jackpot {
            from { opacity: 1; }
            to { opacity: 0.7; }
        }

        /* –¢–ê–ë–õ–ò–¶–ê –í–´–ü–õ–ê–¢ */
        .paytable {
            max-width: 650px;
            margin: 20px auto 0;
            padding: 20px;
            background-color: #000;
            border: 1px dashed var(--accent-pink);
            text-align: left;
        }
        .paytable h2 {
            color: var(--accent-pink);
            text-align: center;
            margin-top: 0;
            border-bottom: 1px solid var(--accent-pink);
            padding-bottom: 10px;
        }
        .paytable ul {
            list-style: none;
            padding: 0;
        }
        .paytable li {
            font-size: 1em;
            margin-bottom: 8px;
            color: var(--text-color);
        }
        .paytable li strong {
            color: var(--win-color);
            float: right;
        }

        /* –°–¢–ê–¢–£–° –í–•–û–î–ê */
        .login-warning {
            color: var(--loss-color);
            font-size: 1.2em;
            font-weight: 700;
            margin-top: 50px;
            padding: 20px;
            border: 2px solid var(--loss-color);
            background-color: rgba(255, 0, 0, 0.1);
        }
    </style>
</head>
<body>
    <div class="nav-bar">
        <a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a>
        <a href="games.html">–ò–≥—Ä—ã</a>
        <a href="about.html">–ê–≤—Ç–æ—Ä</a>
        <a href="login.html">–í—Ö–æ–¥/–í—ã—Ö–æ–¥</a>
    </div>

    <h1>üé∞ –ö–ò–ë–ï–†–ü–ê–ù–ö-–°–õ–û–¢–´ [v.2.1: VISUAL FIX]</h1>

    <div id="game-area">
        <div class="slot-container">
            <div id="balance-display">–ë–ê–õ–ê–ù–°: --</div>
            
            <div id="slot-reels">
                <div class="reel-frame"><div id="reel1" class="reel-inner"></div></div>
                <div class="reel-frame"><div id="reel2" class="reel-inner"></div></div>
                <div class="reel-frame"><div id="reel3" class="reel-inner"></div></div>
            </div>

            <div id="message-display" class="info">–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å. –°–¥–µ–ª–∞–π—Ç–µ —Å—Ç–∞–≤–∫—É.</div>

            <div class="controls">
                <label for="bet-input" style="color: var(--accent-blue); font-weight: 700;">–°–¢–ê–í–ö–ê:</label>
                <input type="number" id="bet-input" value="10" min="1" max="50">
                <button id="spin-button" class="action-button">–°–ü–ò–ù</button>
            </div>
        </div>

        <div class="paytable">
            <h2>–¢–ê–ë–õ–ò–¶–ê –í–´–ü–õ–ê–¢ (–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –†—è–¥)</h2>
            <ul>
                <li>7Ô∏è‚É£7Ô∏è‚É£7Ô∏è‚É£ (–°—É–ø–µ—Ä –†–µ–¥–∫–∏–π) <strong>x100</strong></li>
                <li>üí∞üí∞üí∞, üëæüëæüëæ, ‚ö°‚ö°‚ö° (–†–µ–¥–∫–∏–π) <strong>x40</strong></li>
                <li>üîîüîîüîî, üíéüíéüíé, üåüüåüüåü (–û–±—ã—á–Ω—ã–π) <strong>x8</strong></li>
                <li>üçíüçíüçí, üçáüçáüçá, üçâüçâüçâ, üçäüçäüçä (–§—Ä—É–∫—Ç) <strong>x4</strong></li>
                <li>3 –†–∞–∑–Ω—ã—Ö –§—Ä—É–∫—Ç–∞ (–°–º–µ—à–∞–Ω–Ω—ã–π –≤—ã–∏–≥—Ä—ã—à) <strong>x2</strong></li>
                <li>2 –û–¥–∏–Ω–∞–∫–æ–≤—ã—Ö (–õ—é–±—ã—Ö) <strong>x1.5</strong></li>
                <li>3 —Ä–∞–∑–Ω—ã—Ö –†–µ–¥–∫–∏—Ö/–û–±—ã—á–Ω—ã—Ö/–°–º–µ—à–∞–Ω–Ω—ã—Ö <strong>x0</strong></li>
            </ul>
        </div>
    </div>
    
    <div id="login-warning" class="login-warning" style="display: none;">
        ‚ùå –û–®–ò–ë–ö–ê –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò: –î–ª—è –∏–≥—Ä—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É.
        <br><a href="login.html" style="color: var(--accent-pink); text-decoration: none; font-weight: 900;">–ü–ï–†–ï–ô–¢–ò –ö –í–•–û–î–£</a>
    </div>

    <script>
        window.onload = function() {
            // --- –≠–õ–ï–ú–ï–ù–¢–´ DOM ---
            const BALANCE_DISPLAY = document.getElementById('balance-display');
            const MESSAGE_DISPLAY = document.getElementById('message-display');
            const BET_INPUT = document.getElementById('bet-input');
            const SPIN_BUTTON = document.getElementById('spin-button');
            const REELS = [
                document.getElementById('reel1'),
                document.getElementById('reel2'),
                document.getElementById('reel3')
            ];
            const GAME_AREA = document.getElementById('game-area');
            const LOGIN_WARNING = document.getElementById('login-warning');
            
            // --- –§–õ–ê–ì –î–õ–Ø –ü–†–ï–î–û–¢–í–†–ê–©–ï–ù–ò–Ø –î–í–û–ô–ù–û–ì–û –°–ü–ò–ù–ê ---
            let isSpinning = false;

            // --- –ö–û–ù–°–¢–ê–ù–¢–´ –ò –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨ ---
            const USER_KEY = 'denisKazakovUser'; 
            const MONEY_PREFIX = 'money_';
            const CHECKSUM_PREFIX = 'checksum_';
            const SECRET_KEY = 952; 
            const INITIAL_MONEY = 100;

            // --- –ê–ö–ö–ê–£–ù–¢ –†–ê–ó–†–ê–ë–û–¢–ß–ò–ö–ê (–ß–ò–¢-–†–ï–ñ–ò–ú) ---
            const DEV_USERNAME = 'DenisKazakov';
            const DEV_MONEY = 999999999; 
            
            // --- –°–ò–ú–í–û–õ–´ –ò –ö–ê–¢–ï–ì–û–†–ò–ò ---
            const FRUITS = ['üçí', 'üçá', 'üçâ', 'üçä'];              
            const NORMAL_SYMBOLS = ['üîî', 'üíé', 'üåü'];         
            const RARE_SYMBOLS = ['üí∞', 'üëæ', '‚ö°'];           
            const ULTRA_RARE_SYMBOL = '7Ô∏è‚É£';                     

            // --- –í–ï–°–ê –î–õ–Ø –†–ê–ù–î–û–ú–ê (–°–£–ú–ú–ê = 100) ---
            function getRandomSymbol() {
                const WEIGHTED_SYMBOLS = [
                    ...Array(15).fill(FRUITS[0]), 
                    ...Array(15).fill(FRUITS[1]), 
                    ...Array(15).fill(FRUITS[2]), 
                    ...Array(15).fill(FRUITS[3]), 

                    ...Array(10).fill(NORMAL_SYMBOLS[0]), 
                    ...Array(10).fill(NORMAL_SYMBOLS[1]), 
                    ...Array(10).fill(NORMAL_SYMBOLS[2]), 
                    
                    ...Array(3).fill(RARE_SYMBOLS[0]), 
                    ...Array(3).fill(RARE_SYMBOLS[1]), 
                    ...Array(3).fill(RARE_SYMBOLS[2]), 

                    ...Array(1).fill(ULTRA_RARE_SYMBOL)  
                ];
                
                const index = Math.floor(Math.random() * WEIGHTED_SYMBOLS.length);
                return WEIGHTED_SYMBOLS[index];
            }

            // ===================================================
            // === –§–£–ù–ö–¶–ò–ò –ë–ê–õ–ê–ù–°–ê –° –ß–ò–¢-–õ–û–ì–ò–ö–û–ô (–ù–µ –º–µ–Ω—è—Ç—å) ===
            // ===================================================
            function setInitialMoney(username) {
                const moneyKey = MONEY_PREFIX + username;
                const checksumKey = CHECKSUM_PREFIX + username;
                const newChecksum = INITIAL_MONEY + SECRET_KEY;
                localStorage.setItem(moneyKey, INITIAL_MONEY);
                localStorage.setItem(checksumKey, newChecksum);
            }
            function getMoney() {
                const username = localStorage.getItem(USER_KEY);
                const status = localStorage.getItem('userStatus');

                if (status === 'dev' && username === DEV_USERNAME) {
                    return DEV_MONEY; 
                }

                if (username) {
                    const moneyKey = MONEY_PREFIX + username;
                    let money = parseInt(localStorage.getItem(moneyKey), 10);
                    
                    if (isNaN(money)) {
                        setInitialMoney(username);
                        money = INITIAL_MONEY;
                    }
                    return money;
                }
                return 0; 
            }
            function setMoney(amount) {
                const username = localStorage.getItem(USER_KEY);
                const status = localStorage.getItem('userStatus');

                if (status === 'dev' && username === DEV_USERNAME) {
                    return; 
                }

                if (username) {
                    const moneyKey = MONEY_PREFIX + username;
                    const checksumKey = CHECKSUM_PREFIX + username;
                    
                    const newChecksum = amount + SECRET_KEY;
                    localStorage.setItem(moneyKey, amount);
                    localStorage.setItem(checksumKey, newChecksum);
                }
            }
            function checkChecksum() {
                const username = localStorage.getItem(USER_KEY);
                const status = localStorage.getItem('userStatus');

                if (status === 'dev' && username === DEV_USERNAME) {
                    return true;
                }
                
                const moneyKey = MONEY_PREFIX + username;
                const checksumKey = CHECKSUM_PREFIX + username;
                
                const money = parseInt(localStorage.getItem(moneyKey), 10);
                const storedChecksum = parseInt(localStorage.getItem(checksumKey), 10);
                const calculatedChecksum = money + SECRET_KEY;

                if (storedChecksum === calculatedChecksum) {
                    return true;
                } else {
                    console.error('–û—à–∏–±–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏: –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Å—É–º–º–∞ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç! –°–±—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö.');
                    localStorage.removeItem(moneyKey);
                    localStorage.removeItem(checksumKey);
                    alert('–û—à–∏–±–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏! –î–∞–Ω–Ω—ã–µ –∏–≥—Ä—ã –±—ã–ª–∏ —Å–±—Ä–æ—à–µ–Ω—ã.');
                    return false;
                }
            }
            // ===================================================
            
            // --- –£–¢–ò–õ–ò–¢–´ –ò–ì–†–´ ---

            function updateDisplay() {
                const money = getMoney();
                BALANCE_DISPLAY.textContent = `–ë–ê–õ–ê–ù–°: ${money.toLocaleString('ru-RU')}`;
            }

            function generateReelStrip(finalSymbol, length = 35) {
                let strip = [];
                // –ù–∞—á–∏–Ω–∞–µ–º —Å 3 —Å–ª—É—á–∞–π–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –≤–∏–¥–Ω—ã –≤ –Ω–∞—á–∞–ª–µ
                strip.push(getRandomSymbol(), getRandomSymbol(), getRandomSymbol()); 
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã
                for (let i = 0; i < length - 6; i++) { // –£–º–µ–Ω—å—à–∞–µ–º —Ü–∏–∫–ª –Ω–∞ 6, —á—Ç–æ–±—ã —É—á–µ—Å—Ç—å –Ω–∞—á–∞–ª—å–Ω—ã–µ –∏ –∫–æ–Ω–µ—á–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã
                    strip.push(getRandomSymbol()); 
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º 3 —Å–∏–º–≤–æ–ª–∞, –∫–æ—Ç–æ—Ä—ã–µ –æ–∫—Ä—É–∂–∞—é—Ç –≤—ã–∏–≥—Ä—ã—à–Ω—ã–π –≤ –∫–æ–Ω—Ü–µ —Å–ø–∏–Ω–∞:
                // –í—ã–∏–≥—Ä—ã—à–Ω—ã–π —Å–∏–º–≤–æ–ª (—Ü–µ–Ω—Ç—Ä), –∑–∞—Ç–µ–º —Å–∏–º–≤–æ–ª –Ω–∏–∂–µ, –∑–∞—Ç–µ–º —Å–∏–º–≤–æ–ª –≤—ã—à–µ.
                // –≠—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∞–Ω–∏–º–∞—Ü–∏–∏.
                strip.push(getRandomSymbol()); // –°–∏–º–≤–æ–ª, –∫–æ—Ç–æ—Ä—ã–π –æ–∫–∞–∂–µ—Ç—Å—è –Ω–∞–≤–µ—Ä—Ö—É
                strip.push(finalSymbol);       // –í—ã–∏–≥—Ä—ã—à–Ω—ã–π —Å–∏–º–≤–æ–ª (–æ–∫–∞–∂–µ—Ç—Å—è –≤ —Ü–µ–Ω—Ç—Ä–µ)
                strip.push(getRandomSymbol()); // –°–∏–º–≤–æ–ª, –∫–æ—Ç–æ—Ä—ã–π –æ–∫–∞–∂–µ—Ç—Å—è –≤–Ω–∏–∑—É
                
                return strip;
            }

            // --- –õ–û–ì–ò–ö–ê –ê–ù–ò–ú–ê–¶–ò–ò (3D-–°–ª–æ—Ç—ã) ---

            function spinReel(reelElement, finalSymbol, delay) {
                return new Promise(resolve => {
                    const strip = generateReelStrip(finalSymbol);
                    const symbolHeight = 100;
                    const stripLength = strip.length;
                    
                    reelElement.innerHTML = strip.map(s => `<div>${s}</div>`).join('');
                    
                    // –†–∞—Å—á–µ—Ç –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏ –¥–ª—è —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è finalSymbol (–∫–æ—Ç–æ—Ä—ã–π –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ –ø—Ä–µ–¥–ø–æ—Å–ª–µ–¥–Ω–µ–π –ø–æ–∑–∏—Ü–∏–∏ –≤ strip)
                    // –ß—Ç–æ–±—ã —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–µ–¥–ø–æ—Å–ª–µ–¥–Ω–∏–π —Å–∏–º–≤–æ–ª (index N-2):
                    // –ù—É–∂–Ω–æ –ø—Ä–æ–∫—Ä—É—Ç–∏—Ç—å (N-2) —Å–∏–º–≤–æ–ª–æ–≤ + 1 —Å–∏–º–≤–æ–ª (—á—Ç–æ–±—ã —Å–¥–≤–∏–Ω—É—Ç—å –µ–≥–æ —Å –≤–µ—Ä—Ö–Ω–µ–π –ø–æ–∑–∏—Ü–∏–∏ –≤ —Ü–µ–Ω—Ç—Ä)
                    // Total Scroll = (stripLength - 2) * H + H = (stripLength - 1) * H
                    const finalTranslateY = (stripLength - 2) * symbolHeight;
                    const duration = 2500 + delay; 

                    reelElement.style.transition = `transform ${duration}ms cubic-bezier(0.1, 0.9, 0.4, 1)`;
                    reelElement.style.transform = `translateY(-${finalTranslateY}px)`;


                    setTimeout(() => {
                        // –°–±—Ä–æ—Å –∞–Ω–∏–º–∞—Ü–∏–∏
                        reelElement.style.transition = 'none';
                        
                        // –§–ò–ù–ê–õ–¨–ù–ê–Ø –ü–û–ó–ò–¶–ò–Ø: –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ 3 —Å–∏–º–≤–æ–ª–∞, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–∞–ª—å–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª–∏—Å—å.
                        const finalSymbolsToShow = [
                            strip[stripLength - 3], // –°–∏–º–≤–æ–ª –≤—ã—à–µ —Ü–µ–Ω—Ç—Ä–∞
                            strip[stripLength - 2], // –¶–µ–Ω—Ç—Ä (—Ñ–∏–Ω–∞–ª—å–Ω—ã–π)
                            strip[stripLength - 1]  // –°–∏–º–≤–æ–ª –Ω–∏–∂–µ —Ü–µ–Ω—Ç—Ä–∞
                        ];

                        reelElement.innerHTML = finalSymbolsToShow.map(s => `<div>${s}</div>`).join('');
                        // Transform —Å–¥–≤–∏–≥–∞–µ—Ç –±–∞—Ä–∞–±–∞–Ω, —á—Ç–æ–±—ã –°–ò–ú–í–û–õ –í –¶–ï–ù–¢–†–ï (–∏–Ω–¥–µ–∫—Å 1) –±—ã–ª –≤–∏–¥–µ–Ω.
                        // –°–¥–≤–∏–≥ –Ω–∞ -100px: —Å–¥–≤–∏–≥–∞–µ—Ç –ø–µ—Ä–≤—ã–π —Å–∏–º–≤–æ–ª –∑–∞ –ø—Ä–µ–¥–µ–ª—ã –≤–∏–¥–∏–º–æ—Å—Ç–∏.
                        reelElement.style.transform = `translateY(-${symbolHeight}px)`; 
                        
                        resolve(finalSymbol);
                    }, duration);
                });
            }

            // --- –õ–û–ì–ò–ö–ê –í–´–ò–ì–†–´–®–ê (–ü—Ä–∞–≤–∏–ª–∞ –∏–∑ v.2.0) ---

            function checkWin(results, bet) {
                const counts = {};
                results.forEach(s => { counts[s] = (counts[s] || 0) + 1; });
                const uniqueCount = Object.keys(counts).length;
                let winMultiplier = 0;
                let winMessage = '–ü–†–û–ò–ì–†–´–®. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.';
                let messageClass = 'loss';
                
                // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ç—Ä–æ–π–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ (–≤—ã—Å—à–∏–µ –∏–∫—Å—ã)
                if (uniqueCount === 1) {
                    const symbol = results[0];
                    if (symbol === ULTRA_RARE_SYMBOL) {        // 7Ô∏è‚É£: 100x
                        winMultiplier = 100;
                        winMessage = `7Ô∏è‚É£7Ô∏è‚É£7Ô∏è‚É£ –°–£–ü–ï–† –î–ñ–ï–ö–ü–û–¢! x100`;
                        messageClass = 'jackpot';
                    } else if (RARE_SYMBOLS.includes(symbol)) { // –†–µ–¥–∫–∏–µ: 40x
                        winMultiplier = 40;
                        winMessage = `${symbol}${symbol}${symbol} –ú–ï–ì–ê –í–´–ò–ì–†–´–®! x40`;
                        messageClass = 'jackpot';
                    } else if (NORMAL_SYMBOLS.includes(symbol)) { // –û–±—ã—á–Ω—ã–µ: 8x
                        winMultiplier = 8;
                        winMessage = `${symbol}${symbol}${symbol} –ö–†–£–ü–ù–´–ô –í–´–ò–ì–†–´–®! x8`;
                        messageClass = 'win';
                    } else if (FRUITS.includes(symbol)) {       // –§—Ä—É–∫—Ç—ã: 4x
                        winMultiplier = 4;
                        winMessage = `3 –§–†–£–ö–¢–ê! x4`;
                        messageClass = 'win';
                    }
                }
                
                // 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ 3 —Ä–∞–∑–Ω—ã—Ö –§—Ä—É–∫—Ç–∞ (2x)
                if (winMultiplier === 0 && uniqueCount === 3) {
                    const allAreFruits = results.every(s => FRUITS.includes(s));
                    
                    if (allAreFruits) {
                        winMultiplier = 2;
                        winMessage = '3 –†–ê–ó–ù–´–• –§–†–£–ö–¢–ê! x2';
                        messageClass = 'win';
                    }
                }

                // 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ 2 –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö (1.5x)
                if (winMultiplier === 0) {
                    for (const symbol in counts) {
                        if (counts[symbol] === 2) { 
                            winMultiplier = 1.5;
                            winMessage = '2 –û–î–ò–ù–ê–ö–û–í–´–•! x1.5';
                            messageClass = 'win';
                            break;
                        }
                    }
                }

                const winAmount = bet * winMultiplier;
                
                return { winAmount, winMessage, messageClass };
            }

            // --- –û–°–ù–û–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –ò–ì–†–´ ---

            async function spin() {
                if (isSpinning) return;
                if (!checkChecksum()) return;

                let bet = parseInt(BET_INPUT.value, 10);
                let currentMoney = getMoney();

                if (isNaN(bet) || bet < 1) {
                    MESSAGE_DISPLAY.textContent = '–û–®–ò–ë–ö–ê: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—Ç–∞–≤–∫–∞.';
                    MESSAGE_DISPLAY.className = 'loss';
                    return;
                }
                if (currentMoney < bet) {
                    MESSAGE_DISPLAY.textContent = '–û–®–ò–ë–ö–ê: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ –±–∞–ª–∞–Ω—Å–µ.';
                    MESSAGE_DISPLAY.className = 'loss';
                    return;
                }

                // --- –ù–ê–ß–ê–õ–û –°–ü–ò–ù–ê ---
                isSpinning = true;
                SPIN_BUTTON.disabled = true;
                
                setMoney(currentMoney - bet);
                updateDisplay();
                MESSAGE_DISPLAY.textContent = '–í–†–ê–©–ï–ù–ò–ï –ò–î–ï–¢...';
                MESSAGE_DISPLAY.className = 'info';

                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –≤—ã–∏–≥—Ä—ã—à–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã
                const finalResults = [
                    getRandomSymbol(),
                    getRandomSymbol(),
                    getRandomSymbol()
                ];

                const reelPromises = finalResults.map((result, index) => 
                    spinReel(REELS[index], result, index * 500) 
                );
                
                await Promise.all(reelPromises);

                // --- –û–ö–û–ù–ß–ê–ù–ò–ï –°–ü–ò–ù–ê ---
                isSpinning = false;
                SPIN_BUTTON.disabled = false;

                const { winAmount, winMessage, messageClass } = checkWin(finalResults, bet);
                
                currentMoney = getMoney();
                setMoney(currentMoney + winAmount);
                
                updateDisplay();
                MESSAGE_DISPLAY.textContent = winMessage;
                MESSAGE_DISPLAY.className = messageClass;
            }

            // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ---

            function init() {
                const username = localStorage.getItem(USER_KEY);
                
                if (!username || !checkChecksum()) {
                    GAME_AREA.style.display = 'none';
                    LOGIN_WARNING.style.display = 'block';
                    return;
                }

                GAME_AREA.style.display = 'block';
                LOGIN_WARNING.style.display = 'none';
                
                // –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–æ–≤ –≤ —Ü–µ–Ω—Ç—Ä–µ
                REELS.forEach(reel => {
                    const initialSymbol = getRandomSymbol();
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º 3 —Å–∏–º–≤–æ–ª–∞, —á—Ç–æ–±—ã –±—ã–ª–∞ –≤–∏–¥–Ω–∞ —Ä–∞–º–∫–∞
                    const initialStrip = [getRandomSymbol(), initialSymbol, getRandomSymbol()];
                    reel.innerHTML = initialStrip.map(s => `<div>${s}</div>`).join('');
                    // –°–¥–≤–∏–≥ –Ω–∞ -100px —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ—Ç middleSymbol (–∏–Ω–¥–µ–∫—Å 1)
                    reel.style.transform = `translateY(-100px)`; 
                });

                updateDisplay();
                SPIN_BUTTON.addEventListener('click', spin);
            }

            init();
        };
    </script>
</body>
</html>
