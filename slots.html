<!DOCTYPE html>
<html lang="ru">
<head>
    <title>–°–õ–û–¢–´ | [–°–ò–°–¢–ï–ú–ê] –ò–ì–†–û–í–ê–Ø –ó–û–ù–ê</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        /* –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï */
        :root {
            --bg-color: #0A0A0A; 
            --text-color: #F0F0F0; 
            --accent-pink: #FF33CC; 
            --accent-blue: #33CCFF; 
            --card-bg: #181818; 
            --win-color: #00FF00;
            --jackpot-color: #FFFF00;
            --loss-color: #FF0000;
            --reel-size: 100px; /* –†–∞–∑–º–µ—Ä —Å–∏–º–≤–æ–ª–∞ */
        }

        /* –û–°–ù–û–í–ù–´–ï –°–¢–ò–õ–ò */
        body { 
            font-family: 'Orbitron', sans-serif; 
            background-color: var(--bg-color); 
            color: var(--text-color); 
            text-align: center; 
            padding-top: 80px; 
            margin: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-image: radial-gradient(circle at center, rgba(255, 51, 204, 0.1) 0%, transparent 50%);
        }
        
        /* –ù–ê–í–ò–ì–ê–¶–ò–Ø */
        .nav-bar { 
            background-color: #000000;
            padding: 15px 0; 
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5), 0 0 10px var(--accent-blue);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
        }
        .nav-bar a { 
            color: var(--text-color); 
            padding: 14px 25px; 
            text-decoration: none; 
            font-size: 16px; 
            font-weight: 700; 
            transition: color 0.3s, text-shadow 0.3s;
            border-radius: 5px;
        }
        .nav-bar a:hover { 
            color: var(--accent-pink); 
            text-shadow: 0 0 10px var(--accent-pink); 
        }

        h1 { 
            color: var(--accent-pink); 
            font-size: 3em; 
            font-weight: 900;
            text-shadow: 0 0 25px rgba(255, 51, 204, 1); 
            margin-bottom: 40px;
        }
        
        /* –ö–û–ù–¢–ï–ô–ù–ï–† –°–õ–û–¢–û–í */
        .slot-container {
            width: 90%;
            max-width: 650px;
            background-color: var(--card-bg);
            border: 4px solid var(--accent-blue);
            box-shadow: 0 0 30px rgba(51, 204, 255, 0.5);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            position: relative;
        }

        /* –î–ò–°–ü–õ–ï–ô –ë–ê–õ–ê–ù–°–ê */
        #balance-display {
            color: var(--jackpot-color);
            font-size: 1.5em;
            margin-bottom: 20px;
            border: 2px dashed var(--jackpot-color);
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.3);
            text-shadow: 0 0 10px var(--jackpot-color);
        }

        /* –ü–û–õ–ï –°–õ–û–¢–û–í (–ë–∞—Ä–∞–±–∞–Ω—ã) */
        #slot-reels {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            
            /* –ü–°–ï–í–î–û-3D –≠–§–§–ï–ö–¢ */
            transform-style: preserve-3d;
            perspective: 800px;
        }

        .reel-frame {
            width: var(--reel-size);
            height: var(--reel-size);
            background-color: #000;
            border: 3px solid var(--accent-pink);
            border-radius: 5px;
            overflow: hidden;
            box-shadow: 0 0 15px var(--accent-pink), 0 0 5px var(--accent-blue) inset;
            
            /* –ù–∞–∫–ª–æ–Ω –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞ –º–∞—à–∏–Ω—ã */
            transform: rotateX(10deg);
            position: relative;
        }

        /* –≠–ª–µ–º–µ–Ω—Ç—ã –≤–Ω—É—Ç—Ä–∏ –±–∞—Ä–∞–±–∞–Ω–∞ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ */
        .reel-inner {
            transform: translateY(0);
            will-change: transform; /* –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏ */
        }
        
        .reel-inner div {
            height: var(--reel-size);
            line-height: var(--reel-size);
            font-size: 3em;
            color: var(--text-color);
            text-shadow: 0 0 10px var(--accent-blue); /* –ù–µ–æ–Ω–æ–≤—ã–π —Å–∏–º–≤–æ–ª */
        }
        
        /* –£–ü–†–ê–í–õ–ï–ù–ò–ï –ò–ì–†–û–ô */
        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-top: 20px;
        }

        .action-button {
            padding: 15px 30px;
            background-color: var(--accent-blue);
            color: var(--bg-color);
            border: none;
            border-radius: 5px;
            font-family: 'Orbitron', sans-serif;
            font-size: 1.2em;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 0 15px var(--accent-blue);
            transition: background-color 0.2s, box-shadow 0.2s, transform 0.1s;
        }
        .action-button:hover:not(:disabled) {
            background-color: var(--accent-pink);
            box-shadow: 0 0 20px var(--accent-pink);
            color: var(--text-color);
        }
        .action-button:active:not(:disabled) {
            transform: scale(0.98);
        }
        .action-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* –ò–ù–ü–£–¢ –°–¢–ê–í–ö–ò */
        #bet-input {
            width: 100px;
            padding: 10px;
            text-align: center;
            background-color: #000;
            color: var(--win-color);
            border: 2px solid var(--accent-blue);
            border-radius: 4px;
            font-family: 'Orbitron', sans-serif;
            font-size: 1em;
        }

        /* –°–û–û–ë–©–ï–ù–ò–Ø */
        #message-display {
            font-size: 1.4em;
            min-height: 30px;
            margin-top: 20px;
            font-weight: 700;
        }
        .win { color: var(--win-color); text-shadow: 0 0 10px var(--win-color); }
        .jackpot { color: var(--jackpot-color); text-shadow: 0 0 15px var(--jackpot-color), 0 0 25px var(--jackpot-color); animation: pulse-jackpot 1s infinite alternate; }
        .loss { color: var(--loss-color); text-shadow: 0 0 10px var(--loss-color); }
        .info { color: var(--accent-blue); text-shadow: 0 0 10px var(--accent-blue); }

        @keyframes pulse-jackpot {
            from { opacity: 1; }
            to { opacity: 0.7; }
        }

        /* –¢–ê–ë–õ–ò–¶–ê –í–´–ü–õ–ê–¢ */
        .paytable {
            max-width: 650px;
            margin: 20px auto 0;
            padding: 20px;
            background-color: #000;
            border: 1px dashed var(--accent-pink);
            text-align: left;
        }
        .paytable h2 {
            color: var(--accent-pink);
            text-align: center;
            margin-top: 0;
            border-bottom: 1px solid var(--accent-pink);
            padding-bottom: 10px;
        }
        .paytable ul {
            list-style: none;
            padding: 0;
        }
        .paytable li {
            font-size: 1em;
            margin-bottom: 8px;
            color: var(--text-color);
        }
        .paytable li strong {
            color: var(--win-color);
            float: right;
        }

        /* –°–¢–ê–¢–£–° –í–•–û–î–ê */
        .login-warning {
            color: var(--loss-color);
            font-size: 1.2em;
            font-weight: 700;
            margin-top: 50px;
            padding: 20px;
            border: 2px solid var(--loss-color);
            background-color: rgba(255, 0, 0, 0.1);
        }
    </style>
</head>
<body>
    <div class="nav-bar">
        <a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a>
        <a href="games.html">–ò–≥—Ä—ã</a>
        <a href="about.html">–ê–≤—Ç–æ—Ä</a>
        <a href="login.html">–í—Ö–æ–¥/–í—ã—Ö–æ–¥</a>
    </div>

    <h1>üé∞ –ö–ò–ë–ï–†–ü–ê–ù–ö-–°–õ–û–¢–´ [v.1.1: 3D-FX]</h1>

    <div id="game-area">
        <div class="slot-container">
            <div id="balance-display">–ë–ê–õ–ê–ù–°: --</div>
            
            <div id="slot-reels">
                <div class="reel-frame"><div id="reel1" class="reel-inner"></div></div>
                <div class="reel-frame"><div id="reel2" class="reel-inner"></div></div>
                <div class="reel-frame"><div id="reel3" class="reel-inner"></div></div>
            </div>

            <div id="message-display" class="info">–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å. –°–¥–µ–ª–∞–π—Ç–µ —Å—Ç–∞–≤–∫—É.</div>

            <div class="controls">
                <label for="bet-input" style="color: var(--accent-blue); font-weight: 700;">–°–¢–ê–í–ö–ê:</label>
                <input type="number" id="bet-input" value="10" min="1" max="50">
                <button id="spin-button" class="action-button">–°–ü–ò–ù</button>
            </div>
        </div>

        <div class="paytable">
            <h2>–¢–ê–ë–õ–ò–¶–ê –í–´–ü–õ–ê–¢</h2>
            <ul>
                <li>‚ö°‚ö°‚ö° (–î–ñ–ï–ö–ü–û–¢) <strong>x20</strong></li>
                <li>üëæüëæüëæ <strong>x10</strong></li>
                <li>üí∞üí∞üí∞ <strong>x5</strong></li>
                <li>üí•üí•üí• <strong>x3</strong></li>
                <li>–õ—é–±—ã–µ –¥–≤–∞ ‚ö° <strong>x2</strong></li>
            </ul>
            <p style="font-size: 0.8em; color: #888; margin-top: 15px;">*–í—ã–ø–ª–∞—Ç—ã —É–∫–∞–∑–∞–Ω—ã –∫–∞–∫ –º–Ω–æ–∂–∏—Ç–µ–ª—å –∫ –≤–∞—à–µ–π —Å—Ç–∞–≤–∫–µ.</p>
        </div>
    </div>
    
    <div id="login-warning" class="login-warning" style="display: none;">
        ‚ùå –û–®–ò–ë–ö–ê –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò: –î–ª—è –∏–≥—Ä—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É.
        <br><a href="login.html" style="color: var(--accent-pink); text-decoration: none; font-weight: 900;">–ü–ï–†–ï–ô–¢–ò –ö –í–•–û–î–£</a>
    </div>

    <script>
        window.onload = function() {
            // --- –≠–õ–ï–ú–ï–ù–¢–´ DOM ---
            const BALANCE_DISPLAY = document.getElementById('balance-display');
            const MESSAGE_DISPLAY = document.getElementById('message-display');
            const BET_INPUT = document.getElementById('bet-input');
            const SPIN_BUTTON = document.getElementById('spin-button');
            const REELS = [
                document.getElementById('reel1'),
                document.getElementById('reel2'),
                document.getElementById('reel3')
            ];
            const GAME_AREA = document.getElementById('game-area');
            const LOGIN_WARNING = document.getElementById('login-warning');

            // --- –ö–û–ù–°–¢–ê–ù–¢–´ –ò –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨ ---
            const USER_KEY = 'denisKazakovUser'; 
            const MONEY_PREFIX = 'money_';
            const CHECKSUM_PREFIX = 'checksum_';
            const SECRET_KEY = 952; 
            const INITIAL_MONEY = 100;

            // --- –ê–ö–ö–ê–£–ù–¢ –†–ê–ó–†–ê–ë–û–¢–ß–ò–ö–ê (–ß–ò–¢-–†–ï–ñ–ò–ú) ---
            const DEV_USERNAME = 'DenisKazakov';
            const DEV_MONEY = 999999999; // –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π –±–∞–ª–∞–Ω—Å –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

            // --- –°–ò–ú–í–û–õ–´ –ò –í–´–ü–õ–ê–¢–´ ---
            const SYMBOLS = ['‚ö°', 'üëæ', 'üí∞', 'üí•', '7Ô∏è‚É£']; // 7Ô∏è‚É£ - –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π —Å–∏–º–≤–æ–ª
            const PAYOUTS = {
                '‚ö°,‚ö°,‚ö°': 20, // –î–∂–µ–∫–ø–æ—Ç
                'üëæ,üëæ,üëæ': 10,
                'üí∞,üí∞,üí∞': 5,
                'üí•,üí•,üí•': 3,
                '‚ö°,‚ö°,_': 2, // –õ—é–±—ã–µ –¥–≤–∞ –î–∂–µ–∫–ø–æ—Ç–∞
            };
            
            let isSpinning = false;
            
            // ===================================================
            // === –§–£–ù–ö–¶–ò–ò –ë–ê–õ–ê–ù–°–ê –° –ß–ò–¢-–õ–û–ì–ò–ö–û–ô (–ù–µ –º–µ–Ω—è—Ç—å) ===
            // ===================================================
            function setInitialMoney(username) {
                const moneyKey = MONEY_PREFIX + username;
                const checksumKey = CHECKSUM_PREFIX + username;
                const newChecksum = INITIAL_MONEY + SECRET_KEY;
                localStorage.setItem(moneyKey, INITIAL_MONEY);
                localStorage.setItem(checksumKey, newChecksum);
            }
            function getMoney() {
                const username = localStorage.getItem(USER_KEY);
                const status = localStorage.getItem('userStatus');

                if (status === 'dev' && username === DEV_USERNAME) {
                    return DEV_MONEY; 
                }

                if (username) {
                    const moneyKey = MONEY_PREFIX + username;
                    let money = parseInt(localStorage.getItem(moneyKey), 10);
                    
                    if (isNaN(money)) {
                        setInitialMoney(username);
                        money = INITIAL_MONEY;
                    }
                    return money;
                }
                return 0; 
            }
            function setMoney(amount) {
                const username = localStorage.getItem(USER_KEY);
                const status = localStorage.getItem('userStatus');

                if (status === 'dev' && username === DEV_USERNAME) {
                    return; 
                }

                if (username) {
                    const moneyKey = MONEY_PREFIX + username;
                    const checksumKey = CHECKSUM_PREFIX + username;
                    
                    const newChecksum = amount + SECRET_KEY;
                    localStorage.setItem(moneyKey, amount);
                    localStorage.setItem(checksumKey, newChecksum);
                }
            }
            function checkChecksum() {
                const username = localStorage.getItem(USER_KEY);
                const status = localStorage.getItem('userStatus');

                if (status === 'dev' && username === DEV_USERNAME) {
                    return true;
                }
                
                const moneyKey = MONEY_PREFIX + username;
                const checksumKey = CHECKSUM_PREFIX + username;
                
                const money = parseInt(localStorage.getItem(moneyKey), 10);
                const storedChecksum = parseInt(localStorage.getItem(checksumKey), 10);
                const calculatedChecksum = money + SECRET_KEY;

                if (storedChecksum === calculatedChecksum) {
                    return true;
                } else {
                    console.error('–û—à–∏–±–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏: –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Å—É–º–º–∞ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç! –°–±—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö.');
                    localStorage.removeItem(moneyKey);
                    localStorage.removeItem(checksumKey);
                    alert('–û—à–∏–±–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏! –î–∞–Ω–Ω—ã–µ –∏–≥—Ä—ã –±—ã–ª–∏ —Å–±—Ä–æ—à–µ–Ω—ã.');
                    return false;
                }
            }
            // ===================================================
            
            // --- –£–¢–ò–õ–ò–¢–´ –ò–ì–†–´ ---

            function updateDisplay() {
                const money = getMoney();
                // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ —á—Ç–µ–Ω–∏—è
                BALANCE_DISPLAY.textContent = `–ë–ê–õ–ê–ù–°: ${money.toLocaleString('ru-RU')}`;
            }

            function getRandomSymbol(reelIndex) {
                // –î–æ–±–∞–≤–ª—è–µ–º –≤–µ—Å –¥–ª—è —Å–∏–º–≤–æ–ª–æ–≤
                let weightedSymbols = ['7Ô∏è‚É£', '7Ô∏è‚É£', 'üí•', 'üí∞', 'üëæ', '‚ö°', '7Ô∏è‚É£', 'üí•', 'üí∞', 'üëæ']; 
                
                // –î–µ–ª–∞–µ–º –î–∂–µ–∫–ø–æ—Ç —á—É—Ç—å —Ä–µ–∂–µ
                if (reelIndex % 2 === 0) { // –ù–∞–ø—Ä–∏–º–µ—Ä, –≤ –ø–µ—Ä–≤–æ–º –∏ —Ç—Ä–µ—Ç—å–µ–º –±–∞—Ä–∞–±–∞–Ω–µ
                    weightedSymbols.push('7Ô∏è‚É£'); 
                }
                
                const index = Math.floor(Math.random() * weightedSymbols.length);
                return weightedSymbols[index];
            }

            function generateReelStrip(finalSymbol, length = 30) {
                let strip = [];
                for (let i = 0; i < length - 1; i++) {
                    strip.push(getRandomSymbol(i % 3)); 
                }
                // –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º, —á—Ç–æ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å–∏–º–≤–æ–ª –≤ –ø–æ–ª–æ—Å–µ - —ç—Ç–æ –Ω—É–∂–Ω—ã–π –Ω–∞–º
                strip.push(finalSymbol); 
                return strip;
            }

            // --- –õ–û–ì–ò–ö–ê –ê–ù–ò–ú–ê–¶–ò–ò (–£–ª—É—á—à–µ–Ω–Ω–∞—è) ---

            function spinReel(reelElement, finalSymbol, delay) {
                return new Promise(resolve => {
                    const strip = generateReelStrip(finalSymbol);
                    const symbolHeight = 100; // –î–æ–ª–∂–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å --reel-size
                    const totalSpinHeight = strip.length * symbolHeight;
                    
                    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º HTML –¥–ª—è –ø–æ–ª–æ—Å—ã —Å –Ω—É–∂–Ω—ã–º–∏ —Å–∏–º–≤–æ–ª–∞–º–∏
                    // –î—É–±–ª–∏—Ä—É–µ–º strip –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–∞ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ
                    reelElement.innerHTML = [...strip, ...strip].map(s => `<div>${s}</div>`).join('');
                    
                    // –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: –Ω–∞—Ä–∞—Å—Ç–∞–µ—Ç —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π (—ç—Ñ—Ñ–µ–∫—Ç –∫–∞—Å–∫–∞–¥–∞)
                    const duration = 3000 + delay; // 3.0s, 3.5s, 4.0s

                    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ CSS-–ø–µ—Ä–µ—Ö–æ–¥–∞ —Å Easing-—Ñ—É–Ω–∫—Ü–∏–µ–π –¥–ª—è —Ä–µ–∞–ª–∏–∑–º–∞
                    reelElement.style.transition = `transform ${duration}ms cubic-bezier(0.1, 0.9, 0.4, 1)`;
                    
                    // –°–¥–≤–∏–≥–∞–µ–º –Ω–∞ –≤—ã—Å–æ—Ç—É strip + –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å–∏–º–≤–æ–ª, —á—Ç–æ–±—ã –æ–Ω –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è —Ä–æ–≤–Ω–æ
                    const finalTranslateY = totalSpinHeight; 
                    reelElement.style.transform = `translateY(-${finalTranslateY}px)`;


                    setTimeout(() => {
                        // –°–±—Ä–æ—Å transition –∏ transform –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–ø–∏–Ω–∞
                        reelElement.style.transition = 'none';
                        reelElement.style.transform = `translateY(0)`;
                        
                        // –¢–µ–ø–µ—Ä—å —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç, —á—Ç–æ–±—ã –ø–æ–±–µ–¥–Ω—ã–π —Å–∏–º–≤–æ–ª –±—ã–ª –ø–æ —Ü–µ–Ω—Ç—Ä—É
                        reelElement.innerHTML = `<div>${finalSymbol}</div>`;
                        
                        resolve(finalSymbol);
                    }, duration);
                });
            }

            // --- –õ–û–ì–ò–ö–ê –í–´–ò–ì–†–´–®–ê ---

            function checkWin(results, bet) {
                const rStr = results.join(',');
                let winMultiplier = 0;
                let winMessage = '–ü–†–û–ò–ì–†–´–®. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.';
                let messageClass = 'loss';

                // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–Ω–æ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è (–î–∂–µ–∫–ø–æ—Ç –∏ –¢—Ä–æ–π–∫–∏)
                if (PAYOUTS[rStr]) {
                    winMultiplier = PAYOUTS[rStr];
                } 
                // 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ —Å –¥–≤—É–º—è –î–∂–µ–∫–ø–æ—Ç–∞–º–∏
                else if (rStr.split(',').filter(s => s === '‚ö°').length === 2) {
                    winMultiplier = PAYOUTS['‚ö°,‚ö°,_'];
                }
                
                const winAmount = bet * winMultiplier;
                
                if (winMultiplier > 0) {
                    if (winMultiplier === 20) {
                        winMessage = `‚ö°‚ö°‚ö° –î–ñ–ï–ö–ü–û–¢! –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${winAmount.toLocaleString('ru-RU')}!`;
                        messageClass = 'jackpot';
                    } else {
                        winMessage = `–í–´–ò–ì–†–´–®! –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${winAmount.toLocaleString('ru-RU')}.`;
                        messageClass = 'win';
                    }
                }

                return { winAmount, winMessage, messageClass };
            }

            // --- –û–°–ù–û–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –ò–ì–†–´ ---

            async function spin() {
                if (isSpinning) return;
                if (!checkChecksum()) return;

                let bet = parseInt(BET_INPUT.value, 10);
                let currentMoney = getMoney();

                if (isNaN(bet) || bet < 1) {
                    MESSAGE_DISPLAY.textContent = '–û–®–ò–ë–ö–ê: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—Ç–∞–≤–∫–∞.';
                    MESSAGE_DISPLAY.className = 'error';
                    return;
                }
                if (currentMoney < bet) {
                    MESSAGE_DISPLAY.textContent = '–û–®–ò–ë–ö–ê: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ –±–∞–ª–∞–Ω—Å–µ.';
                    MESSAGE_DISPLAY.className = 'loss';
                    return;
                }

                isSpinning = true;
                SPIN_BUTTON.disabled = true;
                
                setMoney(currentMoney - bet);
                updateDisplay();
                MESSAGE_DISPLAY.textContent = '–í–†–ê–©–ï–ù–ò–ï –ò–î–ï–¢...';
                MESSAGE_DISPLAY.className = 'info';

                const finalResults = [
                    getRandomSymbol(0),
                    getRandomSymbol(1),
                    getRandomSymbol(2)
                ];

                // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é —Å –∫–∞—Å–∫–∞–¥–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
                const reelPromises = finalResults.map((result, index) => 
                    spinReel(REELS[index], result, index * 500) // 0ms, 500ms, 1000ms –∑–∞–¥–µ—Ä–∂–∫–∞
                );
                
                const actualResults = await Promise.all(reelPromises);

                // --- –ü–û–î–°–ß–ï–¢ –†–ï–ó–£–õ–¨–¢–ê–¢–û–í ---
                isSpinning = false;
                SPIN_BUTTON.disabled = false;

                const { winAmount, winMessage, messageClass } = checkWin(actualResults, bet);
                
                currentMoney = getMoney();
                setMoney(currentMoney + winAmount);
                
                updateDisplay();
                MESSAGE_DISPLAY.textContent = winMessage;
                MESSAGE_DISPLAY.className = messageClass;
            }

            // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ---

            function init() {
                const username = localStorage.getItem(USER_KEY);
                
                if (!username || !checkChecksum()) {
                    GAME_AREA.style.display = 'none';
                    LOGIN_WARNING.style.display = 'block';
                    return;
                }

                GAME_AREA.style.display = 'block';
                LOGIN_WARNING.style.display = 'none';
                
                // –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø–æ–∫–∞–∑ —Å–∏–º–≤–æ–ª–æ–≤
                REELS.forEach(reel => {
                    reel.innerHTML = `<div>${SYMBOLS[0]}</div>`;
                });

                updateDisplay();
                SPIN_BUTTON.addEventListener('click', spin);
            }

            init();
        };
    </script>
</body>
</html>
